# NFC Terminal - Raspberry Pi CM4 Buildroot Configuration
# Target: CM4 with 1GB RAM, no WiFi, 8GB eMMC

# Architecture
BR2_aarch64=y
BR2_cortex_a72=y
BR2_ARM_FPU_VFPV4=y

# Toolchain
BR2_TOOLCHAIN_BUILDROOT_CXX=y
BR2_TOOLCHAIN_BUILDROOT_FORTRAN=n

# System Configuration
BR2_TARGET_GENERIC_HOSTNAME="nfc-terminal"
BR2_TARGET_GENERIC_ISSUE="NFC Terminal - Raspberry Pi CM4"
BR2_SYSTEM_DHCP="eth0"
BR2_TARGET_GENERIC_ROOT_PASSWD="nfc-terminal"
BR2_ROOTFS_DEVICE_CREATION_DYNAMIC_EUDEV=y

# Linux headers - use same as kernel being built (6.12)
BR2_KERNEL_HEADERS_AS_KERNEL=y
BR2_PACKAGE_HOST_LINUX_HEADERS_CUSTOM_6_6=y

# Kernel Configuration - Raspberry Pi Linux 6.12
BR2_LINUX_KERNEL=y
BR2_LINUX_KERNEL_CUSTOM_GIT=y
BR2_LINUX_KERNEL_CUSTOM_REPO_URL="https://github.com/raspberrypi/linux.git"
BR2_LINUX_KERNEL_CUSTOM_REPO_VERSION="rpi-6.12.y"
BR2_LINUX_KERNEL_DEFCONFIG="bcm2711"
BR2_LINUX_KERNEL_CONFIG_FRAGMENT_FILES="$(BR2_EXTERNAL_NFC_TERMINAL_PATH)/board/nfc-terminal/linux.config.fragment"

# Device Tree
BR2_LINUX_KERNEL_DTS_SUPPORT=y
BR2_LINUX_KERNEL_INTREE_DTS_NAME="broadcom/bcm2711-rpi-cm4"
BR2_LINUX_KERNEL_DTB_OVERLAY_SUPPORT=y

BR2_LINUX_KERNEL_NEEDS_HOST_OPENSSL=y

# Raspberry Pi Firmware
BR2_PACKAGE_RPI_FIRMWARE=y
BR2_PACKAGE_RPI_FIRMWARE_VARIANT_PI4=y
BR2_PACKAGE_RPI_FIRMWARE_CONFIG_FILE="$(BR2_EXTERNAL_NFC_TERMINAL_PATH)/board/nfc-terminal/config.txt"

# Kernel modules support
BR2_PACKAGE_KMOD=y
BR2_PACKAGE_KMOD_TOOLS=y
BR2_PACKAGE_HOST_KMOD=y

# ST7703 Display Driver Package
BR2_PACKAGE_ST7703_GX040HD=y

# I2C Tools (for debugging and device access)
BR2_PACKAGE_I2C_TOOLS=y

# SSH Server (dropbear is lightweight)
BR2_PACKAGE_DROPBEAR=y
BR2_PACKAGE_DROPBEAR_CLIENT=y

# Useful utilities
BR2_PACKAGE_BUSYBOX_SHOW_OTHERS=y
BR2_PACKAGE_XZ=y
BR2_PACKAGE_NANO=y
BR2_PACKAGE_HTOP=y
BR2_PACKAGE_ETHTOOL=y
BR2_PACKAGE_IPROUTE2=y

# Boot splash (framebuffer image viewer)
BR2_PACKAGE_FBV=y
BR2_PACKAGE_FBV_PNG=y

# Required host tools for image generation
BR2_PACKAGE_HOST_DOSFSTOOLS=y
BR2_PACKAGE_HOST_GENIMAGE=y
BR2_PACKAGE_HOST_MTOOLS=y

# CM4 eMMC flashing tool
BR2_PACKAGE_HOST_RASPBERRYPI_USBBOOT=y

# Filesystem Configuration
BR2_TARGET_ROOTFS_EXT2=y
BR2_TARGET_ROOTFS_EXT2_4=y
BR2_TARGET_ROOTFS_EXT2_SIZE="512M"
# BR2_TARGET_ROOTFS_TAR is not set

# Post-build and Post-image Scripts
BR2_ROOTFS_POST_BUILD_SCRIPT="$(BR2_EXTERNAL_NFC_TERMINAL_PATH)/board/nfc-terminal/post-build.sh"
BR2_ROOTFS_POST_IMAGE_SCRIPT="$(BR2_EXTERNAL_NFC_TERMINAL_PATH)/board/nfc-terminal/post-image.sh"
